name: Auto Label Issues

on:
  issues:
    types: [opened]

permissions:
  issues: write
  contents: read

jobs:
  auto-label:
    runs-on: ubuntu-latest
    
    steps:
      - name: Extract issue info and add labels
        uses: actions/github-script@v6
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body;
            const title = issue.title;
            
            console.log('Issue body:', body);
            console.log('Issue title:', title);
            
            const labels = [];
            
            // ì´ìŠˆ íƒ€ìž… ì¶”ì¶œ ë° ë¼ë²¨ ë§¤í•‘
            const typeMatch = body.match(/### ì´ìŠˆ íƒ€ìž…\s*\n\s*(.+)/);
            if (typeMatch) {
              const type = typeMatch[1].trim();
              console.log('Issue type:', type);
              
              // íƒ€ìž…ë³„ ë¼ë²¨ ë§¤í•‘
              const typeLabels = {
                'ðŸš€ feature - ìƒˆë¡œìš´ ê¸°ëŠ¥': ['feature', 'ðŸš€ feature'],
                'ðŸš€ feature - ìƒˆë¡œìš´ API/ê¸°ëŠ¥': ['feature', 'ðŸš€ feature'],
                'ðŸš€ feature - ìƒˆë¡œìš´ LLM ê¸°ëŠ¥': ['feature', 'ðŸš€ feature'],
                'ðŸš€ feature - ìƒˆë¡œìš´ ì¸í”„ë¼ êµ¬ì„±': ['feature', 'ðŸš€ feature'],
                'ðŸ› bug - ë²„ê·¸ ìˆ˜ì •': ['bug', 'ðŸ› bug'],
                'ðŸ› bug - LLM ì‘ë‹µ ì˜¤ë¥˜': ['bug', 'ðŸ› bug'],
                'ðŸ› bug - ë°°í¬/ìš´ì˜ ì´ìŠˆ': ['bug', 'ðŸ› bug'],
                'âœ¨ enhancement - ê¸°ëŠ¥ ê°œì„ ': ['enhancement', 'âœ¨ enhancement'],
                'ðŸŽ¨ style - UI/ìŠ¤íƒ€ì¼ ë³€ê²½': ['style', 'ðŸŽ¨ design'],
                'â™»ï¸ refactor - ë¦¬íŒ©í† ë§': ['refactor', 'â™»ï¸ refactor'],
                'âš¡ performance - ì„±ëŠ¥ ê°œì„ ': ['performance', 'âš¡ performance'],
                'âš¡ performance - ì‘ë‹µ ì†ë„ ê°œì„ ': ['performance', 'âš¡ performance'],
                'ðŸ”’ security - ë³´ì•ˆ ê°•í™”': ['security', 'ðŸ”’ security'],
                'ðŸ—ƒï¸ database - DB ê´€ë ¨': ['database', 'ðŸ—ƒï¸ database'],
                'ðŸŽ¯ accuracy - ì •í™•ë„ ê°œì„ ': ['accuracy', 'ðŸŽ¯ accuracy'],
                'ðŸ’° cost - ë¹„ìš© ìµœì í™”': ['cost-optimization', 'ðŸ’° cost'],
                'ðŸ”§ integration - ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™': ['integration', 'ðŸ”§ integration'],
                'ðŸ”§ maintenance - ìœ ì§€ë³´ìˆ˜': ['maintenance', 'ðŸ”§ maintenance'],
                'ðŸ“Š monitoring - ëª¨ë‹ˆí„°ë§ ì„¤ì •': ['monitoring', 'ðŸ“Š monitoring'],
                'ðŸ“š docs - ë¬¸ì„œí™”': ['documentation', 'ðŸ“š docs'],
                'ðŸ§ª test - í…ŒìŠ¤íŠ¸': ['test', 'ðŸ§ª test'],
                'ðŸ”§ chore - ê¸°íƒ€ ìž‘ì—…': ['chore', 'ðŸ”§ chore'],
                'â“ question - ì§ˆë¬¸': ['question', 'â“ question']
              };
              
              if (typeLabels[type]) {
                labels.push(...typeLabels[type]);
              }
            }
            
            // ì¹´í…Œê³ ë¦¬ë³„ ë¼ë²¨ ì¶”ê°€ (title prefix ê¸°ë°˜)
            if (title.startsWith('[FE]')) {
              labels.push('frontend', 'ðŸŽ¨ frontend');
            } else if (title.startsWith('[BE]')) {
              labels.push('backend', 'âš™ï¸ backend');
            } else if (title.startsWith('[LLM]')) {
              labels.push('llm', 'ðŸ¤– llm');
            } else if (title.startsWith('[INFRA]')) {
              labels.push('infrastructure', 'ðŸ—ï¸ infra');
            } else if (title.startsWith('[GENERAL]')) {
              labels.push('general', 'ðŸ“‹ general');
            }
            
            // ìš°ì„ ìˆœìœ„ ë¼ë²¨ ì¶”ê°€ (General í…œí”Œë¦¿ìš©)
            const priorityMatch = body.match(/### â­ ìš°ì„ ìˆœìœ„\s*\n\s*(.+)/);
            if (priorityMatch) {
              const priority = priorityMatch[1].trim();
              const priorityLabels = {
                'ðŸ”´ HIGH - ê¸´ê¸‰': ['priority: high', 'ðŸ”´ high'],
                'ðŸŸ¡ MEDIUM - ë³´í†µ': ['priority: medium', 'ðŸŸ¡ medium'],
                'ðŸŸ¢ LOW - ë‚®ìŒ': ['priority: low', 'ðŸŸ¢ low']
              };
              
              if (priorityLabels[priority]) {
                labels.push(...priorityLabels[priority]);
              }
            }
            
            // ì¤‘ë³µ ì œê±°
            const uniqueLabels = [...new Set(labels)];
            
            console.log('Labels to add:', uniqueLabels);
            
            if (uniqueLabels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: uniqueLabels
              });
              
              console.log('Labels added successfully');
            }